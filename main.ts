enum ActionKind {
    Walking,
    Idle,
    Jumping,
    Dead
}
namespace SpriteKind {
    export const Ground = SpriteKind.create()
    export const Cloud = SpriteKind.create()
}
function initGround () {
    ground1 = sprites.create(img`
        ...................................................................................1111...........................................................................
        ..................................................................................1....1..........................................................................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111......11111111111111111....11111111111111111111111111111111111111111111111111111
        .........................................................................................................1111.....................................................
        ..................................................................................................................................................................
        ..1111..1.......................1..1111.........................1111..1.............1..........................1111..1...........1..111.................1..111....
        ..................................................................................................................................................................
        ...............1111..1.........................1111.1.......1..............11.1........1111..1.....1111..1..................1...............1111..1...............
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        `, SpriteKind.Ground)
    ground2 = sprites.create(img`
        .....................................................1111..................1111...................................................................................
        ....................................................1....1................1....1..................................................................................
        1111111111111111111111111111111111111111111111111111......1111111111111111......1111111111111111111111111111111111111111111111111111111111111111111111111111111111
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ....111..1.................111..1...........1..1111..........................1.............1..1111.........................1111..1.......................1..1111..
        ..................................................................................................................................................................
        ...............1..1111...............1..................1..1111.....1..1111........1.11..............1.......1.1111.........................1..1111...............
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        ..................................................................................................................................................................
        `, SpriteKind.Ground)
    ground1.setPosition(scene.screenWidth() / 2, 120)
    ground2.setPosition(ground1.x + scene.screenWidth(), 120)
    ground1.vx = -100
    ground2.vx = -100
    ground1.z = 2
    ground2.z = 2
}
function initRaptor () {
    wichtel = sprites.create(img`
        ........................
        ........................
        ......55................
        ......552...............
        .......222..............
        ........222.............
        ........2222............
        ........2222............
        ........22222...........
        .........2222...........
        .........22222..........
        .........22222..........
        .........22222..........
        .........22787..........
        .........7777dd.........
        ........77777dd.........
        ........777222..........
        ........7777111.........
        ........7777111.........
        .......77777111.........
        .......77777711.........
        ......777777711.........
        ......77777777166.......
        ..........7776666.......
        `, SpriteKind.Player)
    run = animation.createAnimation(ActionKind.Walking, 100)
    run.addAnimationFrame(img`
        ........................
        ........................
        ......55................
        ......552...............
        .......222..............
        ........222.............
        ........2222............
        ........2222............
        ........22222...........
        .........2222...........
        .........22222..........
        .........22222..........
        .........22222..........
        .........22787..........
        .........7777dd.........
        ........77777dd.........
        ........777222..........
        ........7777111.........
        ........7777111.........
        .......77777111.........
        .......77777711.........
        ......777777711.........
        ......77777777166.......
        ..........7776666.......
        `)
    run.addAnimationFrame(img`
        ........................
        ........................
        .......55...............
        .......55...............
        .......222..............
        ........222.............
        ........2222............
        ........2222............
        ........22222...........
        .........2222...........
        .........22222..........
        .........22222..........
        .........22222..........
        .........22787..........
        .........7777dd.........
        ........77777dd.........
        ........777222..........
        ........7777111.........
        ........77771111........
        .......777777111.6......
        .....7777777771116......
        ....77777777776666......
        ........77777766........
        ..........77766.........
        `)
    animation.attachAnimation(wichtel, run)
    jump = animation.createAnimation(ActionKind.Jumping, 200)
    jump.addAnimationFrame(img`
        .........55.............
        .........55.............
        .........22.............
        .........222............
        ........2222............
        ........2222............
        ........2222............
        ........2222............
        ........2222............
        ........22222...........
        ........2222............
        .........7777...........
        .........7777...........
        .........77787..........
        .........7777dd.........
        ........77727dd.........
        ........777222..........
        ........777711..........
        ........7711111.........
        .......77111117.........
        .......77111177.........
        ......777777777.........
        ......77777777766.......
        ..........7776666.......
        `)
    animation.attachAnimation(wichtel, jump)
    dead = animation.createAnimation(ActionKind.Dead, 200)
    dead.addAnimationFrame(img`
        ........................
        ........................
        ........................
        ........................
        ........................
        ........................
        ........................
        ........................
        ..........555...........
        ..........555...........
        .........25552..........
        .........22222..........
        .........22222..........
        .........222222.........
        .........222222.........
        ........22222222........
        ........22222222........
        ........22222222........
        ........27222212........
        .......77777111.........
        .......77777711.........
        ......777777711.........
        ......77777777166.......
        ..........7776666.......
        `)
    animation.attachAnimation(wichtel, dead)
    wichtel.z = 3
    wichtel.setPosition(15, 94)
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.Projectile, function (sprite, otherSprite) {
    end = 1
    animation.setAction(wichtel, ActionKind.Dead)
    pause(50)
    game.over(false, effects.dissolve)
})
controller.anyButton.onEvent(ControllerButtonEvent.Pressed, function () {
    if (wichtel.y == 94 && end == 0) {
        wichtel.vy = -160
        animation.setAction(wichtel, ActionKind.Jumping)
    }
})
let cloud: Sprite = null
let cactus: Sprite = null
let choice = 0
let dead: animation.Animation = null
let jump: animation.Animation = null
let run: animation.Animation = null
let wichtel: Sprite = null
let ground2: Sprite = null
let ground1: Sprite = null
let end = 0
let idle = null
game.setDialogCursor(img`
    ........................
    ........................
    ......55................
    ......552...............
    .......222..............
    ........222.............
    ........2222............
    ........2222............
    ........22222...........
    .........2222...........
    .........22222..........
    .........22222..........
    .........22222..........
    .........22787..........
    .........7777dd.........
    ........77777dd.........
    ........777222..........
    ........7777111.........
    ........7777111.........
    .......77777111.........
    .......77777711.........
    ......777777711.........
    ......77777777166.......
    ..........7776666.......
    `)
game.splash("Wichtel Run", "Der Weihnachtscode")
scene.setBackgroundColor(15)
initGround()
initRaptor()
info.setScore(0)
end = 0
game.showLongText("Drücke auf einen Knopf zum Hüpfen, bei 500 Punkten erhältst du das Codewort!", DialogLayout.Top)
game.onUpdate(function () {
    if (wichtel.y < 94) {
        wichtel.ay = 400
    } else {
        wichtel.ay = 0
        wichtel.y = 94
        if (end == 0) {
            animation.setAction(wichtel, ActionKind.Walking)
        }
    }
})
game.onUpdateInterval(50, function () {
    info.changeScoreBy(1)
    if (info.score() > 500) {
        game.splash("Das Codewort lautet", "Morozko")
        pause(1000)
        game.over(true, effects.blizzard)
    }
})
game.onUpdateInterval(1000, function () {
    ground1.vx += -1
    ground2.vx += -1
})
game.onUpdateInterval(1000, function () {
    choice = randint(0, 4)
    if (choice == 0) {
        cactus = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ...............55...............
            ...............55...............
            ...............55...............
            ...............55...............
            ...............77...............
            ...............777..............
            ...............777..............
            ..............77777.............
            .............7777.7777..........
            ..........77772777.77...........
            ...........777277..777..........
            ............77777....777........
            ...........777.77.7.7277........
            .........7777.7.777722..........
            .........77.777.777722..........
            ...........7227777.7777.........
            .........772277777....77777777..
            ..777777777..7777.77777777...7..
            ....7777..7777e777e77777...77...
            ........777777eeeee7777..77.....
            ...........7..eeeee777777.......
            ..............eeee.e............
            ..............eeee.e............
            ..............e.ee.e............
            ..............ee...e............
            ................eeee............
            ................................
            ................................
            `, ground1.vx, 0)
        cactus.y = 94
        cactus.z = 2
    } else if (choice == 1) {
        cactus = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ..........5.....................
            .........55.......55............
            .........45........5............
            .........45........4............
            .........45........45...........
            ........222.2222..222.222.......
            ........222.2222..222.222.......
            ........222.2222..222.222.......
            ........222..222..222.2222......
            ........222..222..222.2222......
            .......72227722277222772227.....
            ......7722277222772227722277....
            ......7722277222772227722277....
            `, ground1.vx, 0)
        cactus.y = 94
        cactus.z = 2
    } else if (choice == 2) {
        cactus = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            .............111................
            ............11111...............
            ............11f111..............
            ...........1111111..............
            .........444111111..............
            ............11111...............
            .............1111...............
            ............111111..............
            ...........11111111.............
            ...........11111111.............
            ...........11111111.............
            ............111111..............
            ..........1111111111............
            .........11111111111............
            .........111111111111...........
            ........1111111111111...........
            ........11111111111111..........
            ........11111111111111..........
            ........11111111111111..........
            .........111111111111...........
            .........11111111111............
            `, ground1.vx, 0)
        cactus.y = 94
        cactus.z = 2
    }
})
game.onUpdateInterval(1500, function () {
    if (Math.percentChance(20)) {
        cloud = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            .......................5........
            ......................555.......
            ......................555.......
            ....................555555......
            ....................5555555.....
            ......................55555.....
            ......................555.......
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            `, ground1.vx / 4, 0)
        cloud.y = randint(20, 60)
        cloud.setKind(SpriteKind.Cloud)
        cloud.z = 1
    }
    if (Math.percentChance(87)) {
        cloud = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ..............1.................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            `, ground1.vx / 4, 0)
        cloud.y = randint(20, 60)
        cloud.setKind(SpriteKind.Cloud)
        cloud.z = 1
    }
    if (Math.percentChance(87)) {
        cloud = sprites.createProjectileFromSide(img`
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ................................
            ......................1.........
            ................................
            ................................
            ................................
            ................................
            `, ground1.vx / 4, 0)
        cloud.y = randint(20, 60)
        cloud.setKind(SpriteKind.Cloud)
        cloud.z = 1
    }
})
forever(function () {
    if (ground1.x < -1 * (scene.screenWidth() / 2)) {
        ground1.x = ground2.x + scene.screenWidth()
    }
    if (ground2.x < -1 * (scene.screenWidth() / 2)) {
        ground2.x = ground1.x + scene.screenWidth()
    }
})
